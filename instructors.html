<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Lingua Bud Instructors</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
    }

    header {
      background-color: #20bcba;
      color: white;
      padding: 1rem;
      text-align: center;
      font-size: 1.8rem;
    }

    .filters {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      background: #fff;
      padding: 1rem;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    select {
      padding: 0.5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .instructor-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 2rem;
      padding: 2rem;
    }

    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      padding: 1rem;
      text-align: center;
    }

    .card img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 1rem;
      border: 2px solid #20bcba;
    }

    .card h3 {
      margin: 0.5rem 0;
      color: #1e1e1e;
    }

    .card p {
      margin: 0.3rem 0;
      color: #555;
    }

    .hire-btn {
      margin-top: 1rem;
      padding: 0.6rem 1.2rem;
      background-color: #20bcba;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .hire-btn:hover {
      background-color: #1a9d9b;
    }

    @media (max-width: 600px) {
      .filters {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <header>Lingua Bud Instructors</header>

  <div class="filters">
    <select id="languageFilter">
      <option value="">Filter by Language</option>
      <option value="English">English</option>
      <option value="Spanish">Spanish</option>
      <option value="French">French</option>
      <option value="Portuguese">Portuguese</option>
      <option value="Italian">Italian</option>
    </select>
    <select id="priceFilter">
      <option value="">Filter by Max Price</option>
      <option value="10">$10</option>
      <option value="15">$15</option>
      <option value="20">$20</option>
      <option value="25">$25</option>
      <option value="30">$30</option>
    </select>
  </div>

  <div class="instructor-grid" id="instructorGrid">
    <!-- Cards will appear here -->
  </div>

  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'

    const supabase = createClient(
      'https://fryhforpxlavbpimaljf.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyeWhmb3JweGxhdmJwaW1hbGpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4ODIwNDEsImV4cCI6MjA2NjQ1ODA0MX0.S5XbzUZeq4lCR2O-_siaSg86b6FQwLxvizF3yVvpidI'
    );

    const instructorGrid = document.getElementById('instructorGrid');
    const languageFilter = document.getElementById('languageFilter');
    const priceFilter = document.getElementById('priceFilter');

    let allInstructors = [];

    async function fetchInstructors() {
      const { data, error } = await supabase.from('instructors').select('*');
      if (error) {
        console.error('Error fetching instructors:', error);
        return;
      }
      allInstructors = data;
      populateLanguageOptions(data);
      renderInstructors();
    }

    function populateLanguageOptions(data) {
      const languages = new Set();
      data.forEach(instructor => {
        try {
          const teaching = JSON.parse(instructor.languages_teaching || '[]');
          teaching.forEach(lang => languages.add(lang));
        } catch {}
      });

      languageFilter.innerHTML = `<option value="">Filter by Language</option>`;
      Array.from(languages).sort().forEach(lang => {
        const option = document.createElement('option');
        option.value = lang;
        option.textContent = lang;
        languageFilter.appendChild(option);
      });
    }

    function renderInstructors() {
      const selectedLang = languageFilter.value;
      const maxPrice = parseFloat(priceFilter.value);
      instructorGrid.innerHTML = '';

      const filtered = allInstructors.filter(instructor => {
        try {
          const teaches = JSON.parse(instructor.languages_teaching || '[]');
          const matchesLang = selectedLang ? teaches.includes(selectedLang) : true;
          const price = parseFloat(instructor.price_per_lesson);
          const matchesPrice = maxPrice ? price <= maxPrice : true;
          return matchesLang && matchesPrice;
        } catch {
          return false;
        }
      });

      filtered.forEach(instructor => {
        const spoken = JSON.parse(instructor.languages_spoken || '[]');
        const teaching = JSON.parse(instructor.languages_teaching || '[]');
        const price = instructor.price_per_lesson || '';
        const currency = instructor.currency || '$';
        const avatar = instructor.avatar_url || 'https://via.placeholder.com/100';

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${avatar}" alt="${instructor.name}'s avatar">
          <h3>${instructor.name}</h3>
          <p><strong>Speaks:</strong> ${spoken.join(', ')}</p>
          <p><strong>Teaches:</strong> ${teaching.join(', ')}</p>
          <p><strong>About Me:</strong> ${instructor.about_me || 'No bio yet'}</p>
          <p><strong>Price:</strong> ${currency}${price} per hour</p>
          <button class="hire-btn">Hire</button>
        `;
        instructorGrid.appendChild(card);
      });
    }

    languageFilter.addEventListener('change', renderInstructors);
    priceFilter.addEventListener('change', renderInstructors);

    fetchInstructors();
  </script>
</body>
</html>
