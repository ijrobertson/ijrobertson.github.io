<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Instructor Dashboard</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Segoe+UI&display=swap" />
  <script type="module" src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
      color: #333;
    }

    .container {
      max-width: 600px;
      margin: auto;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 20px;
    }

    h1 {
      color: #20bcba;
      text-align: center;
    }

    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }

    select, input[type="text"], input[type="number"], textarea {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    .language-list {
      margin-top: 10px;
    }

    .language-item {
      background-color: #e0f7f6;
      display: flex;
      justify-content: space-between;
      padding: 8px;
      border-radius: 5px;
      margin-top: 5px;
    }

    .language-item button {
      background: none;
      border: none;
      color: red;
      cursor: pointer;
    }

    button {
      background-color: #20bcba;
      color: white;
      padding: 10px;
      margin-top: 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      width: 100%;
    }

    button:hover {
      background-color: #179a9a;
    }

    .profile-picture {
      margin: 10px 0;
    }

    .profile-picture img {
      max-width: 100px;
      border-radius: 50%;
    }

    input[type="file"] {
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Instructor Dashboard</h1>

    <label for="spokenLanguages">Languages You Speak</label>
    <select id="spokenLanguages">
      <option value="">Select a language</option>
    </select>
    <button type="button" onclick="addLanguage('spoken')">Add Language</button>
    <div id="spokenLanguageList" class="language-list"></div>

    <label for="teachingLanguages">Languages You Teach</label>
    <select id="teachingLanguages">
      <option value="">Select a language</option>
    </select>
    <button type="button" onclick="addLanguage('teaching')">Add Language</button>
    <div id="teachingLanguageList" class="language-list"></div>

    <label for="currency">Currency</label>
    <select id="currency">
      <option value="USD">USD - US Dollar</option>
      <option value="EUR">EUR - Euro</option>
      <option value="GBP">GBP - British Pound</option>
      <option value="JPY">JPY - Japanese Yen</option>
      <option value="INR">INR - Indian Rupee</option>
      <option value="BRL">BRL - Brazilian Real</option>
      <option value="CNY">CNY - Chinese Yuan</option>
      <option value="CAD">CAD - Canadian Dollar</option>
    </select>

    <label for="price">Price per Lesson</label>
    <input type="number" id="price" min="0" />

    <label for="bio">About Me</label>
    <textarea id="bio" rows="4"></textarea>

    <label for="country">Native Country</label>
    <select id="country"></select>

    <label for="profilePicture">Profile Picture</label>
    <input type="file" id="profilePicture" accept="image/*" />

    <div class="profile-picture" id="previewContainer"></div>

    <button onclick="saveProfile()">Save Profile</button>
  </div>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabase = createClient('https://YOUR_PROJECT.supabase.co', 'YOUR_PUBLIC_ANON_KEY');

    const user = await supabase.auth.getUser();
    const userId = user?.data?.user?.id;

    if (!userId) {
      alert("Please log in first.");
      window.location.href = "login.html";
    }

    const topLanguages = ["English", "Mandarin", "Hindi", "Spanish", "French", "Arabic", "Bengali", "Portuguese", "Russian", "Urdu"];
    const additionalLanguages = ["German", "Italian", "Japanese", "Korean", "Swahili", "Turkish", "Vietnamese", "Persian", "Polish", "Thai", "Dutch", "Romanian", "Czech", "Greek", "Hungarian", "Hebrew", "Malay", "Punjabi", "Telugu", "Tamil", "Ukrainian", "Javanese", "Marathi", "Hausa", "Burmese", "Pashto", "Kannada", "Yoruba", "Odia", "Zulu", "Amharic", "Nepali", "Sinhala", "Tagalog", "Malayalam"];
    const allLanguages = [...topLanguages, ...additionalLanguages.sort()];

    const countries = [...new Set([
      "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia",
      "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium",
      "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria",
      "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad",
      "Chile", "China", "Colombia", "Comoros", "Congo", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czech Republic",
      "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea",
      "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia",
      "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Honduras",
      "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Ivory Coast", "Jamaica",
      "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon",
      "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia",
      "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova",
      "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", "Namibia", "Nauru", "Nepal",
      "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Korea", "North Macedonia", "Norway", "Oman",
      "Pakistan", "Palau", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal", "Puerto Rico", "Qatar",
      "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa",
      "San Marino", "São Tomé e Príncipe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore",
      "Slovakia", "Slovenia", "Solomon Islands", "Somalia", "South Africa", "South Korea", "South Sudan", "Spain", "Sri Lanka",
      "Sudan", "Suriname", "Sweden", "Switzerland", "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste",
      "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine",
      "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City",
      "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
    ].sort())];

    function populateSelect(id, options) {
      const select = document.getElementById(id);
      options.forEach(option => {
        const el = document.createElement("option");
        el.value = option;
        el.textContent = option;
        select.appendChild(el);
      });
    }

    populateSelect("spokenLanguages", allLanguages);
    populateSelect("teachingLanguages", allLanguages);
    populateSelect("country", countries);

    let spokenLangs = [];
    let teachingLangs = [];

    function addLanguage(type) {
      const select = document.getElementById(type === 'spoken' ? 'spokenLanguages' : 'teachingLanguages');
      const value = select.value;
      if (!value) return;

      const list = type === 'spoken' ? spokenLangs : teachingLangs;
      if (!list.includes(value)) list.push(value);
      renderLanguages();
    }

    function removeLanguage(type, lang) {
      const list = type === 'spoken' ? spokenLangs : teachingLangs;
      const index = list.indexOf(lang);
      if (index !== -1) list.splice(index, 1);
      renderLanguages();
    }

    function renderLanguages() {
      ["spoken", "teaching"].forEach(type => {
        const list = type === "spoken" ? spokenLangs : teachingLangs;
        const container = document.getElementById(type + "LanguageList");
        container.innerHTML = "";
        list.forEach(lang => {
          const div = document.createElement("div");
          div.className = "language-item";
          div.innerHTML = `${lang} <button onclick="removeLanguage('${type}', '${lang}')">×</button>`;
          container.appendChild(div);
        });
      });
    }

    window.addLanguage = addLanguage;
    window.removeLanguage = removeLanguage;

    async function saveProfile() {
      const bio = document.getElementById("bio").value;
      const country = document.getElementById("country").value;
      const currency = document.getElementById("currency").value;
      const price = document.getElementById("price").value;
      const profilePicInput = document.getElementById("profilePicture");
      let profile_pic_url = null;

      if (profilePicInput.files.length > 0) {
        const file = profilePicInput.files[0];
        const { data, error } = await supabase.storage.from('avatars').upload(`public/${userId}`, file, {
          upsert: true,
        });
        if (!error) {
          const { data: publicUrlData } = supabase.storage.from('avatars').getPublicUrl(`public/${userId}`);
          profile_pic_url = publicUrlData.publicUrl;
        }
      }

      const { error } = await supabase.from("instructors").upsert({
        user_id: userId,
        spoken_languages: spokenLangs,
        teaching_languages: teachingLangs,
        currency,
        price_per_lesson: price,
        bio,
        country,
        profile_pic_url
      });

      if (error) {
        alert("Error saving profile: " + error.message);
      } else {
        alert("Profile saved successfully!");
      }
    }

    window.saveProfile = saveProfile;
  </script>
</body>
</html>
