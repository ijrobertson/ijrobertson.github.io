<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Instructor Dashboard</title>
  <style>
    :root {
      --turquoise: #20bcba;
      --white: #ffffff;
      --light-grey: #f5f5f5;
      --dark-grey: #444444;
      --navy-blue: #002b5b;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--light-grey);
      margin: 0;
      padding: 0;
    }

    .container {
      max-width: 600px;
      margin: 40px auto;
      background-color: var(--white);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }

    h2 {
      color: var(--navy-blue);
      text-align: center;
      margin-bottom: 24px;
    }

    label {
      font-weight: 600;
      display: block;
      margin-top: 16px;
      color: var(--dark-grey);
    }

    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 8px;
      font-size: 16px;
    }

    .currency-select {
      display: flex;
      gap: 10px;
    }

    button {
      margin-top: 24px;
      width: 100%;
      background-color: var(--turquoise);
      color: var(--white);
      border: none;
      padding: 14px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s ease;
    }

    button:hover {
      background-color: var(--navy-blue);
    }

    .status {
      text-align: center;
      margin-top: 16px;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Your Instructor Profile</h2>

    <label for="name">Full Name</label>
    <input type="text" id="name" />

    <label for="language_spoken">Language(s) You Speak</label>
    <select id="language_spoken" multiple></select>

    <label for="language">Language(s) You Teach</label>
    <select id="language" multiple></select>

    <label for="price">Price per Lesson</label>
    <div class="currency-select">
      <input type="number" id="price" />
      <select id="currency">
        <option value="USD">USD ($)</option>
        <option value="EUR">EUR (€)</option>
        <option value="GBP">GBP (£)</option>
        <option value="JPY">JPY (¥)</option>
        <option value="INR">INR (₹)</option>
        <option value="CAD">CAD ($)</option>
        <option value="AUD">AUD ($)</option>
        <option value="MXN">MXN ($)</option>
        <option value="BRL">BRL (R$)</option>
        <option value="CNY">CNY (¥)</option>
      </select>
    </div>

    <label for="bio">About Me</label>
    <textarea id="bio" rows="4"></textarea>

    <label for="country">Native Country</label>
    <select id="country"></select>

    <button id="save-btn">Save Profile</button>
    <div class="status" id="status"></div>
  </div>

  <script type="module">
    import { supabase } from './lib/supabaseClient.js';

    const languages = [
      "Mandarin Chinese", "English", "Hindi", "Spanish", "French", "Arabic", "Bengali",
      "Russian", "Portuguese", "Urdu", "Indonesian", "German", "Japanese", "Swahili",
      "Marathi", "Telugu", "Turkish", "Tamil", "Vietnamese", "Korean", "Italian", "Thai",
      "Gujarati", "Polish", "Ukrainian", "Persian", "Malayalam", "Kannada", "Dutch", "Punjabi",
      "Romanian", "Greek", "Hungarian", "Czech", "Swedish", "Hebrew", "Norwegian", "Danish",
      "Finnish", "Serbian", "Slovak", "Bulgarian", "Croatian", "Nepali", "Sinhala", "Tagalog",
      "Amharic", "Zulu", "Hausa", "Burmese"
    ];

    const countries = [
      "Afghanistan","Albania","Algeria","Andorra","Angola","Argentina","Armenia","Australia","Austria","Azerbaijan",
      "Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia","Bosnia and Herzegovina",
      "Botswana","Brazil","Brunei","Bulgaria","Burkina Faso","Burundi","Cambodia","Cameroon","Canada","Cape Verde","Central African Republic",
      "Chad","Chile","China","Colombia","Comoros","Congo","Costa Rica","Croatia","Cuba","Cyprus","Czech Republic","Denmark","Djibouti",
      "Dominica","Dominican Republic","East Timor","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Eswatini",
      "Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia","Germany","Ghana","Greece","Grenada","Guatemala","Guinea",
      "Guinea-Bissau","Guyana","Haiti","Honduras","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy",
      "Ivory Coast","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Korea, North","Korea, South","Kosovo","Kuwait",
      "Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Madagascar",
      "Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Mauritania","Mauritius","Mexico","Micronesia","Moldova",
      "Monaco","Mongolia","Montenegro","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal","Netherlands","New Zealand",
      "Nicaragua","Niger","Nigeria","North Macedonia","Norway","Oman","Pakistan","Palau","Panama","Papua New Guinea","Paraguay",
      "Peru","Philippines","Poland","Portugal","Qatar","Romania","Russia","Rwanda","Saint Kitts and Nevis","Saint Lucia",
      "Saint Vincent","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone",
      "Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Sudan","Spain","Sri Lanka","Sudan",
      "Suriname","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Togo","Tonga","Trinidad and Tobago",
      "Tunisia","Turkey","Turkmenistan","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States",
      "Uruguay","Uzbekistan","Vanuatu","Vatican City","Venezuela","Vietnam","Yemen","Zambia","Zimbabwe"
    ];

    const languageSelects = [document.getElementById('language'), document.getElementById('language_spoken')];
    const countrySelect = document.getElementById('country');

    languageSelects.forEach(select => {
      languages.forEach(lang => {
        const opt = document.createElement('option');
        opt.value = lang;
        opt.textContent = lang;
        select.appendChild(opt);
      });
    });

    countries.forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      countrySelect.appendChild(opt);
    });

    async function getUser() {
      const { data: { user } } = await supabase.auth.getUser();
      return user;
    }

    document.getElementById('save-btn').addEventListener('click', async () => {
      const user = await getUser();
      const name = document.getElementById('name').value;
      const language = Array.from(document.getElementById('language').selectedOptions).map(opt => opt.value);
      const language_spoken = Array.from(document.getElementById('language_spoken').selectedOptions).map(opt => opt.value);
      const price = document.getElementById('price').value;
      const currency = document.getElementById('currency').value;
      const bio = document.getElementById('bio').value;
      const country = document.getElementById('country').value;
      const status = document.getElementById('status');

      if (!user) {
        status.textContent = 'Not logged in.';
        return;
      }

      const { error } = await supabase
        .from('instructors')
        .upsert({
          user_id: user.id,
          name,
          language,
          language_spoken,
          price,
          currency,
          bio,
          country
        }, { onConflict: ['user_id'] });

      if (error) {
        status.textContent = error.message;
        status.style.color = 'red';
      } else {
        status.textContent = 'Profile saved successfully!';
        status.style.color = 'green';
      }
    });
  </script>
</body>
</html>
