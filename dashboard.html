<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Instructor Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 0;
      color: #333;
    }

    header {
      background-color: #20bcba;
      color: white;
      padding: 1rem;
      text-align: center;
    }

    .container {
      max-width: 700px;
      margin: 2rem auto;
      background: white;
      padding: 2rem;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    label {
      display: block;
      margin-top: 1rem;
      margin-bottom: 0.5rem;
      font-weight: bold;
    }

    input, select, button, textarea {
      width: 100%;
      padding: 0.7rem;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-bottom: 1rem;
      font-size: 1rem;
    }

    .tag {
      background-color: #20bcba;
      color: white;
      border-radius: 15px;
      padding: 0.3rem 0.8rem;
      display: inline-block;
      margin-right: 0.5rem;
      margin-bottom: 0.5rem;
      cursor: pointer;
    }

    button {
      background-color: #20bcba;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #199c9a;
    }

    .profile-pic-preview {
      max-width: 150px;
      max-height: 150px;
      margin-bottom: 1rem;
      border-radius: 50%;
    }
  </style>
</head>
<body>
  <header>
    <h1>Instructor Dashboard</h1>
  </header>

  <div class="container">
    <label for="avatar">Profile Picture</label>
    <input type="file" id="avatar" accept="image/*" />
    <img id="avatarPreview" class="profile-pic-preview" src="#" alt="" style="display:none;"/>

    <label for="spokenLanguage">Languages You Speak</label>
    <select id="spokenLanguage">
      <!-- Options inserted dynamically -->
    </select>
    <button onclick="addLanguage('spoken')">Add Language</button>
    <div id="spokenLanguages"></div>

    <label for="teachingLanguage">Languages You Teach</label>
    <select id="teachingLanguage">
      <!-- Options inserted dynamically -->
    </select>
    <button onclick="addLanguage('teaching')">Add Language</button>
    <div id="teachingLanguages"></div>

    <label for="price">Price Per Lesson</label>
    <input type="number" id="price" placeholder="Enter price" />
    <select id="currency">
      <option value="USD">$ USD</option>
      <option value="EUR">€ EUR</option>
      <option value="GBP">£ GBP</option>
      <option value="CAD">$ CAD</option>
      <option value="AUD">$ AUD</option>
    </select>

    <label for="bio">About Me</label>
    <textarea id="bio" rows="5" placeholder="Write a short bio..."></textarea>

    <label for="country">Native Country</label>
    <select id="country">
      <!-- Countries inserted dynamically -->
    </select>

    <button onclick="saveProfile()">Save Profile</button>
  </div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    const supabase = createClient(
      'https://fryhforpxlavbpimaljf.supabase.co',
      'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyeWhmb3JweGxhdmJwaW1hbGpmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA4ODIwNDEsImV4cCI6MjA2NjQ1ODA0MX0.S5XbzUZeq4lCR2O-_siaSg86b6FQwLxvizF3yVvpidI'
    );

    const languages = [
      "Mandarin Chinese", "Spanish", "English", "Hindi", "Arabic", "Bengali", "Portuguese", "Russian", "Urdu", "Indonesian",
      "German", "French", "Japanese", "Punjabi", "Turkish", "Vietnamese", "Korean", "Italian", "Thai", "Polish",
      "Ukrainian", "Persian", "Dutch", "Romanian", "Czech", "Greek", "Hungarian", "Swedish", "Hebrew", "Danish",
      "Norwegian", "Finnish", "Malayalam", "Telugu", "Tamil", "Marathi", "Swahili", "Javanese", "Burmese", "Serbian",
      "Slovak", "Croatian", "Bulgarian", "Malay", "Filipino", "Amharic", "Zulu", "Kazakh", "Nepali", "Sinhala"
    ];

    const countries = [
      "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Argentina", "Armenia", "Australia", "Austria", "Azerbaijan",
      "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan", "Bolivia",
      "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cambodia", "Cameroon", "Canada",
      "Cape Verde", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo (Brazzaville)", "Congo (Kinshasa)", "Costa Rica",
      "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic", "East Timor", "Ecuador",
      "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France",
      "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau",
      "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland",
      "Israel", "Italy", "Ivory Coast", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Kuwait",
      "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg",
      "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", "Mexico",
      "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", "Namibia", "Nauru",
      "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Korea", "North Macedonia", "Norway", "Oman",
      "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines", "Poland", "Portugal",
      "Puerto Rico", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent", "Samoa", "San Marino",
      "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", "Solomon Islands", "Somalia",
      "South Africa", "South Korea", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland", "Syria",
      "São Tomé and Príncipe", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey",
      "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Uzbekistan", "Vanuatu",
      "Vatican City", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
    ];

    function populateSelect(id, items) {
      const select = document.getElementById(id);
      items.forEach(item => {
        const option = document.createElement('option');
        option.value = item;
        option.text = item;
        select.appendChild(option);
      });
    }

    populateSelect('spokenLanguage', languages);
    populateSelect('teachingLanguage', languages);
    populateSelect('country', countries);

    function addLanguage(type) {
      const select = document.getElementById(type + 'Language');
      const value = select.value;
      if (!value) return;

      const container = document.getElementById(type + 'Languages');
      const span = document.createElement('span');
      span.className = 'tag';
      span.textContent = value;
      span.onclick = () => span.remove();
      container.appendChild(span);
    }

    document.getElementById('avatar').addEventListener('change', e => {
      const reader = new FileReader();
      reader.onload = () => {
        const img = document.getElementById('avatarPreview');
        img.src = reader.result;
        img.style.display = 'block';
      };
      reader.readAsDataURL(e.target.files[0]);
    });

    async function saveProfile() {
      const {
        data: { user }
      } = await supabase.auth.getUser();

      if (!user) {
        alert('Please log in first');
        return;
      }

      const spoken = [...document.getElementById('spokenLanguages').children].map(c => c.textContent);
      const teaching = [...document.getElementById('teachingLanguages').children].map(c => c.textContent);

      const profile = {
        user_id: user.id,
        spoken_languages: spoken,
        teaching_languages: teaching,
        price_per_lesson: document.getElementById('price').value,
        currency: document.getElementById('currency').value,
        bio: document.getElementById('bio').value,
        native_country: document.getElementById('country').value,
        email: user.email
      };

      const { error } = await supabase.from('instructors').upsert(profile, {
        onConflict: 'user_id'
      });

      if (error) {
        console.error(error);
        alert('Error saving profile');
      } else {
        alert('Profile saved!');
      }
    }
  </script>
</body>
</html>
